<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Simulated 2FA Login</title>
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      background: #111;
      color: white;
      padding: 20px;
      max-width: 400px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    button {
      cursor: pointer;
      background: white;
      color: black;
      font-weight: bold;
    }
    button:hover {
      background: gray;
      color: white;
    }
    #phone-section, #otp-section {
      display: none;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js"></script>
</head>
<body>

<h2>Login</h2>
<div id="login-section">
  <input type="email" id="email" placeholder="Email" required />
  <input type="password" id="password" placeholder="Password" required />
  <button id="login-btn">Login</button>
</div>

<div id="phone-section">
  <h2>Verify Phone</h2>
  <div id="recaptcha-container"></div>
  <input type="tel" id="phone" placeholder="+63xxxxxxxxxx" />
  <button id="send-code-btn">Send Verification Code</button>
</div>

<div id="otp-section">
  <h2>Enter OTP</h2>
  <input type="text" id="otp" placeholder="Enter code" />
  <button id="verify-code-btn">Verify Code</button>
</div>

<div id="message"></div>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBtraV34vofWZK_d8gcZPRP0U7TgYIuXW4",
    authDomain: "firefinder-d5c0a.firebaseapp.com",
    projectId: "firefinder-d5c0a",
    storageBucket: "firefinder-d5c0a.appspot.com",
    messagingSenderId: "221428549294",
    appId: "1:221428549294:web:be5a7164bb363eaf9e0f3f",
    databaseURL: "https://firefinder-d5c0a-default-rtdb.firebaseio.com"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Elements
  const loginSection = document.getElementById('login-section');
  const phoneSection = document.getElementById('phone-section');
  const otpSection = document.getElementById('otp-section');
  const messageDiv = document.getElementById('message');

  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const phoneInput = document.getElementById('phone');
  const otpInput = document.getElementById('otp');

  const loginBtn = document.getElementById('login-btn');
  const sendCodeBtn = document.getElementById('send-code-btn');
  const verifyCodeBtn = document.getElementById('verify-code-btn');

  let confirmationResult;

  // Setup reCAPTCHA
  let recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
    size: 'normal',
    callback: () => {
      console.log('reCAPTCHA solved');
    },
    'expired-callback': () => {
      messageDiv.textContent = 'reCAPTCHA expired, please verify again.';
    }
  });

  // Login with email/password first
  loginBtn.addEventListener('click', () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    messageDiv.textContent = '';
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        messageDiv.textContent = 'Login successful! Now verify your phone.';
        loginSection.style.display = 'none';
        phoneSection.style.display = 'block';
      })
      .catch(err => {
        messageDiv.textContent = 'Login failed: ' + err.message;
      });
  });

  // Send verification code via phone
  sendCodeBtn.addEventListener('click', () => {
    const phoneNumber = phoneInput.value;
    messageDiv.textContent = '';
    auth.signInWithPhoneNumber(phoneNumber, recaptchaVerifier)
      .then((result) => {
        confirmationResult = result;
        messageDiv.textContent = 'Verification code sent!';
        phoneSection.style.display = 'none';
        otpSection.style.display = 'block';
      })
      .catch(err => {
        messageDiv.textContent = 'Error sending code: ' + err.message;
      });
  });

  // Verify the OTP code
  verifyCodeBtn.addEventListener('click', () => {
    const code = otpInput.value;
    messageDiv.textContent = '';
    confirmationResult.confirm(code)
      .then(() => {
        messageDiv.textContent = 'Phone verification successful! You are fully logged in.';
        otpSection.style.display = 'none';
        // Here you can redirect the user or show logged-in content
      })
      .catch(err => {
        messageDiv.textContent = 'Invalid code: ' + err.message;
      });
  });
</script>

</body>
</html>

